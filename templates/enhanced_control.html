<!doctype html>
<html>
<head>
  <title>Code of the Sea</title>
  <style>
    body {
        font-family: Arial, sans-serif;
        background: linear-gradient(135deg, #e6f7ff, #cceeff);
        padding: 20px;
        min-height: 100vh;
        margin: 0;
        color: #0d375a;
    }
    h1, h2 {
        text-align: center;
        color: #0a2d48;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
    .script {
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(5px);
        padding: 20px;
        margin: 15px auto;
        border-radius: 12px;
        width: 320px;
        text-align: center;
        box-shadow: 0 4px 15px rgba(0, 40, 60, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.5);
    }
    button {
        padding: 10px 20px;
        margin: 5px;
        font-size: 15px;
        cursor: pointer;
        border: none;
        border-radius: 8px;
        color: #fff;
        font-weight: bold;
        transition: transform 0.2s, background-color 0.2s;
    }
    button:active { transform: scale(0.95); }
    .running { color: #2a8a9a; font-weight: bold; }
    .stopped { color: #e55c5c; font-weight: bold; }
    .status-text { margin-top: 10px; font-weight: bold; }
    input[type="range"] { width: 80%; }
    .button-group { display: flex; flex-direction: column; align-items: center; }
  </style>
</head>
<body>
  <h1>ðŸŒŠ Code of the Sea</h1>
  <h2>Control Panel</h2>
  
  <!-- Fan Service Control -->
  <div class="script">
    <h3>Fan Service</h3>
    <p>Status:
      {% if 'Fan Service' in processes %}
        <span class="running">Running</span>
      {% else %}
        <span class="stopped">Stopped</span>
      {% endif %}
    </p>
    {% if 'Fan Service' not in processes %}
      <form action="{{ url_for('start_fan_service') }}" method="post">
        <button type="submit" style="background-color: #2a8a9a;">Start Fan Service</button>
      </form>
    {% else %}
      <form action="{{ url_for('stop_fan_service') }}" method="post">
        <button type="submit" style="background-color: #e55c5c;">Stop Fan Service</button>
      </form>

      <!-- Fan Mode and Speed Control -->
      <div style="margin-top: 20px; border-top: 1px solid #ccc; padding-top: 10px;">
        <h4>Fan Control Options</h4>
        <p class="status-text">
          Mode: {{ fan_config['mode'] }}
          {% if fan_config['mode'] == 'manual' %}
            (Speed: {{ fan_config['speed_percent'] }}%)
          {% endif %}
        </p>
        <form action="{{ url_for('set_fan_mode') }}" method="post" style="display:inline-block;">
          <input type="hidden" name="mode" value="mic">
          <button type="submit" style="background-color: #2a8a9a;">Mic Controlled</button>
        </form>
        <form action="{{ url_for('set_fan_mode') }}" method="post" style="display:inline-block;">
          <input type="hidden" name="mode" value="off">
          <button type="submit" style="background-color: #e55c5c;">Fan Off</button>
        </form>
        <div style="margin-top: 20px;">
          <label for="speed-range">Manual Speed:</label>
          <input type="range" id="speed-range" name="speed" min="0" max="100" value="{{ fan_config['speed_percent'] }}" onchange="document.getElementById('speed-display').innerText=this.value+'%'">
          <span id="speed-display">{{ fan_config['speed_percent'] }}%</span>
          <button type="button" onclick="setManualSpeed()" style="background-color: #2a8a9a;">Set Speed</button>
        </div>
      </div>
    {% endif %}
  </div>

  <!-- Other Scripts Control -->
  {% for name, path in scripts.items() %}
    <div class="script">
      <h3>{{ name }}</h3>
      <p>Status:
        {% if name in processes %}
          <span class="running">Running</span>
        {% else %}
          <span class="stopped">Stopped</span>
        {% endif %}
      </p>
      <form action="{{ url_for('start_script', script=name) }}" method="post">
        <button type="submit" style="background-color: #2a8a9a;">Start</button>
      </form>
      <form action="{{ url_for('stop_script', script=name) }}" method="post">
        <button type="submit" style="background-color: #e55c5c;">Stop</button>
      </form>
    </div>
  {% endfor %}

  <script>
    function setManualSpeed() {
      const speed = document.getElementById('speed-range').value;
      fetch('/set_fan_speed', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ speed: speed })
      }).then(() => {
        window.location.reload();
      });
    }
  </script>
</body>
</html>